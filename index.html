<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title>Instageo</title>
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  
<!-- jquery -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script> 

<!-- Mapbox.js API  -->
<script src='https://api.tiles.mapbox.com/mapbox.js/v2.1.9/mapbox.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox.js/v2.1.9/mapbox.css' rel='stylesheet' />

<!-- Font awesome -->
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

<!-- Leaflet Locate -->
<script src='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-locatecontrol/v0.42.0/L.Control.Locate.min.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-locatecontrol/v0.42.0/L.Control.Locate.mapbox.css' rel='stylesheet' />
<!--[if lt IE 9]>
  <link href='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-locatecontrol/v0.42.0/L.Control.Locate.ie.css' rel='stylesheet' />
<![endif]-->

<style>
body {background: #333; margin:0;padding:0;}
  * {-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;}
  h1 {font-size:22px;margin:0;font-weight:400;}
  a {
    color:#404040;
    text-decoration:none;
  }
  a:hover { color:#101010; }

  .footer {
    position:absolute;
    width:100%;
    height:33%;
    bottom:0;
    //overflow:hidden;
    border-right:1px solid rgba(0,0,0,0.25);
  }
  .pad2 {
    padding:20px;
  }
  .quiet {
    color:#888;
  }
  .map {
    position:absolute;
    height: 66%;
    width:100%;
    top:0;bottom:0;
  }
  .listings {
    height:100%;
    overflow:auto;
    padding-bottom:60px;
  }
  .listings .item {
    position: relative;
    padding:10px;
    text-decoration:none;
  }
  .listings .item img {
    background: #fff;
    margin-bottom: 10px;
    height: 300px;
  }
  .listings .item .title {
    display:block;
    color:#fff;
    font-weight:700;
  }
  .listings .item .title small { font-weight:400; }
  .listings .item.active .title,
  .listings .item .title:hover { color:#8cc63f; }
  .listings .item.active {
    background-color:#f8f8f8;
  }
  ::-webkit-scrollbar {
    width:3px;
    height:3px;
    border-left:0;
    background:rgba(0,0,0,0.1);
  }
  ::-webkit-scrollbar-track {
    background:none;
  }
  ::-webkit-scrollbar-thumb {
    background:#FFE800;
    border-radius:0;
  }
  .clearfix { display:block; }
  .clearfix:after {
    content:'.';
    display:block;
    height:0;
    clear:both;
    visibility:hidden;
  }
  .trigger {
      color: #000;
      position: relative;
      top: 97%;
      left: 5%;
      z-index: 10;
  }
  
  /* Marker tweaks */
  .leaflet-popup-content {    
    background: #B44176;
    color: #fff;
    border-color: #fff;
    border-radius:12px;
    margin: 6px;
    text-align: center;
  }
  .leaflet-popup-content-wrapper {border-radius: 12px; background: #B44176; color: #fff;}
  .leaflet-popup-content a {color: #bada55;}
  .leaflet-popup-content h2 {font-size:32px;}
  .leaflet-popup-content a:hover {color: #d8fc62;}
  .leaflet-popup-tip {border-top: 10px solid #B44176;}
  .leaflet-popup-close-button {
    display:none;
  }
  .leaflet-popup-content div {
    padding:10px;
  }
  .leaflet-container .leaflet-marker-icon { cursor:pointer; }
  img.center {
   position: absolute;
   top: 30%;
   left: 50%;
   margin-top: -24px; /* Half the height */ 
   margin-left: -24px; /* Half the width */
}
</style>
</head>
<body>

<div id='map' class='map'>
  <div id='camera' class='listings'><span class='trigger fa fa-camera-retro fa-5x'></span></div>
</div>
<img src="./img/crosshair.png" class="center" id="arrow" />
<div class='footer'>
  <div id='listings'></div>
</div>
<script>
L.mapbox.accessToken = 'pk.eyJ1IjoidHJpc3RlbiIsImEiOiJiUzBYOEJzIn0.VyXs9qNWgTfABLzSI3YcrQ';
var map = L.mapbox.map('map', 'grafa.m8p63n24',{zoomControl:false})
    .setView([45.55473, -122.66654], 19);
  
new L.Control.Zoom({ position: 'topright' }).addTo(map);

L.control.locate().addTo(map);

// click the camera icon to load IG images
$('#camera').on('click', '.trigger', function() {
    // get IG tokens from https://instagram.com/developer/clients/manage/
    var accessToken = 'fa7735431203415882fa980bd386baca';
    var lat = map.getCenter('features').lat,
        lng = map.getCenter('features').lng

    $.ajax({
        // distance in meters
        url: 'https://api.instagram.com/v1/media/search?lat=' + lat + '&lng=' + lng + '&distance=80',
        dataType: 'jsonp',
        type: 'GET',
        data: {client_id: accessToken},
        success: function(data){
            console.log(data);

            var listing = listings.appendChild(document.createElement('div'));
            $("div").remove(".item");

            for(x in data.data){
              listing.className = 'item';

              var link = listing.appendChild(document.createElement('a'));
              link.href = '#';
              link.className = 'title';
              link.innerHTML = '<a href="http://instagram.com/' +data.data[x].user.username+ '" target="_blank"><img src="'+data.data[x].images.low_resolution.url+'" class="listing item"></a>';
            }
        }
    });
});



</script>
</body>
</html>